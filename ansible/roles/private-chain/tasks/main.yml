---
#- name: Create accounts
#  command: parity account new --config node.toml
#  args:
#    chdir: "{{ parity_dir }}"

- name: Import parity account
  command: "parity account import {{ parity_dir }}/keys/PrivateChain/{{ ansible_host }}"

- command: "parity account list"
  register: validator_address

- name: Add validator to node.toml
  lineinfile: >-
    dest='{{ parity_dir }}/node.toml'
    state=present
    backrefs=yes
    regexp='^engine_signer.*'
    line='engine_signer = "{{ validator_address.stdout }}"'

- name: Reload supervisor to start parity
  service: name=supervisor state=reloaded
  tags:
    - tmp
